<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DeskBot Firmware: DeskBot Development Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DeskBot Firmware
   </div>
   <div id="projectbrief">Firmware for 4DOF Desktop Robotic Arm</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DeskBot Development Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="media/DeskBotActual.jpg" alt="" width="300" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md0"></a>
About the Deskbot</h2>
<p>Deskbot is a 4-DOF robotic arm powered by an STM32F4 microcontroller on a specially designed PCB. The shoulder and elbow are driven by three DC motors, while the wrist and end effector are actuated by servo motors. The arm features:</p><ul>
<li>Cascading PID Control on the shoulder and elbow joint DC motors</li>
<li>Encoder-based position feedback</li>
<li><a class="el" href="struct_servo.html" title="Internal servo tracking structure.">Servo</a> control for wrist and end effector actuation</li>
<li>UART integration for command and control</li>
</ul>
<h2><a class="anchor" id="autotoc_md1"></a>
Demo Video</h2>
<p><a href="https://youtube.com/shorts/2_fX5DbKXUc">▶️ Watch on YouTube</a></p>
<h2><a class="anchor" id="autotoc_md2"></a>
Firmware/Software Overview</h2>
<p>DeskBot, in its current state, begins by entering a calibration state where it drives the joints slowly to their limits, indicated by a limit switch. This allows the system to then derive absolute position from the encoders. Following this process, the arm can then recieve position commands via UART in the format "(theta1, theta2, theta3, theta4, theta5)". Theta1-theta4 represent joint angles, while theta5 is the command for the end effector command. While our inverse kinematic model is functioning in MATLAB, it has yet to be translated to C and still needs some adjustments to avoid issues regarding singularities in the rotation matrices.</p>
<p>Firmware for the deskbot was written in C and is detailed in the data structures and files section of the documentation.</p>
<p>The firmware was structured in a pseudo-object-oriented style, where each "object", such as a motor or controller, has a corresponding structure and functions which operate on said struct.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Control Diagram</h2>
<p><img src="media/DeskBotControlFlow.png" alt="" width="600" class="inline"/></p>
<ul>
<li>Cascading position and velocity control architecture allows for precise, disturbance resistant motor control</li>
<li>Integral windup protection via clamping, as well as output clamping to respect acutator limits</li>
<li>Tolerable error margin to zero the integral near setpoint to increase stability and reduce oscillations</li>
<li>Designed for integer math to increase performance on embedded systems</li>
<li>Integrated via <a class="el" href="controller_8h.html#aea21866d20385943adecd5eed051bd64" title="Updates the PID controller and computes a new output.">PID_Update()</a> to support interrupt driven cooperative programming.</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Mechanical Design</h2>
<p><img src="media/DeskBotMechanical.png" alt="" height="400" class="inline"/> <img src="media/DeskBotExplodedView.png" alt="" height="400" class="inline"/> <img src="media/DeskBotJointCloseUp.png" alt="" height="400" class="inline"/> <img src="media/DeskBotEndEffector.png" alt="" height="400" class="inline"/></p>
<ul>
<li>Designed and 3D-printed custom linkages, base, end effector, and mounting hub, balancing sleek aesthetics with functional performance.</li>
<li>Implemented a direct-drive base; shoulder and elbow joints utilize a 4:1 gear reduction via timing belts for increased torque and precision.</li>
<li>Integrated servo-driven end effector for precise pitch control and coordinated actuation of gripper fingers.</li>
<li>Developed adjustable slotted motor mounts to enable fine-tuning of belt tension for optimal performance.</li>
<li>Embedded gear mesh features directly into the 3D-printed linkages to streamline assembly and reduce part count.</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Board Design</h2>
<p><img src="media/DeskBotPCB.png" alt="" width="400" class="inline"/></p>
<ul>
<li>4-Layer PCB hosting an STM43F411CEU6 for DeskBot Control</li>
<li>Switching Regulator and LDO used for 6V and 3.3V respectively from a 3S LiPo Battery</li>
<li>High current tolerating polygons used for motor supply.</li>
<li>Featured:<ul>
<li>Three dual-channel H-bridge motor drivers</li>
<li><a class="el" href="struct_servo.html" title="Internal servo tracking structure.">Servo</a> headers for wrist and gripper</li>
<li>Quadrature encoder headers routed to TIM1-3</li>
<li>limit switch inputs with pull-up resistors</li>
<li>Optional joystick headers for further expansion in control</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Challenges During Development</h2>
<p>The biggest challenge we faced during development was an oversight in the board design. The servo PWM channels were accidentally routed to the same timer as one of the DC motor PWM channels. Since the servos and DC motor cannot operate even near the same frequency, we opted to develop software driven PWM to control the servos. We did so by triggering an internal timer at 4000 times the frequency required by the servo, and triggering the GPIO connected to the servo manually to generate the desired waveform. While this granted us the theoretical resolution of 1 degree of accuracy, the slightly inconsistent waveform led to some servo jitter. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
